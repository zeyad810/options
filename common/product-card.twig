{% if product %}
	<div class="product-item {% if product.is_infinite == false and product.quantity <= 0 %}product-item-out-of-stock{% endif %}">
		<a class="d-flex flex-column justify-content-start">
			<div class="box-1-1">
				<div class="content">
					<div class="d-flex justify-content-center" style="width: 100%; height: 100%; position: relative; overflow: hidden;">
						<img id="product-card-img-{{ product.id }}" style="object-position: center; width: 100%; height: 100%;" {% if product.images %} src="{{ imageUrl(product.images[0]['image']['medium'],{ w: 400, q: 85, f:'auto' }) }}" {% else %} src="{{ imageUrl(asset_url ~ 'product-img.svg',{ w: 235, q: 85, f:'auto' }) }}" {% endif %} alt="{{ product.name }}" loading="lazy">
						<span class="product-card-bundle-offer" data-bundle-offer-product-id="{{ product.id }}"></span>
					</div>
				</div>

				<!-- عرض التفاصيل -->
				<div class="text-center desk">
					<button id="open-product-details-{{ product.id }}" type="button" class="open-product-details" data-product-id="{{ product.selected_product.id }}" data-product-name="{{ product.name }}" data-product-image="{{ imageUrl(product.images[0]['image']['medium'], { w: 400, q: 85, f: 'auto' }) }}" data-real-price="{{ product.formatted_sale_price ? product.formatted_sale_price : product.formatted_price }}" data-product-price="{{ product.formatted_price }}" data-discount="{{ product.discount_percentage }}" data-category="{{ product.categories[0].name }}" data-description="{{ product.short_description }}" data-id="{{ product.id }}" data-isinfinite="{{ product.is_infinite }}" data-quantity="{{ product.quantity }}" data-has-options="{{ product.has_options }}" data-has-fields="{{ product.has_options }}" data-slug="{{ product.slug }}" data-asset-url="{{ asset_url }}" style="margin-bottom: 4px; transition: .3s;">
						<i class="fa-regular fa-eye"></i>
						<span>عرض التفاصيل</span>
					</button>

					{% if product.is_infinite == false and product.quantity <= 0 %}
						<a class="btn btn-primary btn-product-card-out-of-stock" disabled>{{ locals.lbl_error_product_out_of_stock }}</a>
					{% elseif product.has_options or product.has_fields %}
						<a class="btn btn-primary btn-product-card-select-variant" href="/products/{{ product.slug }}">{{ locals.add_to_cart }}</a>
					{% else %}
						<a href="javascript:void(0)" class="btn btn-primary product-card-add-to-cart" onclick="productCartAddToCart(this,'{{ product.id }}')">
							<img style="display: inline" class="add-to-cart-progress d-none" src="{{ asset_url }}spinner.gif" width="20px" height="20px"/>
							{{ locals.add_to_cart }}
						</a>
					{% endif %}
				</div>
			</div>

			<!-- تفاصيل المنتج -->
			<div class="product-all-content">
				<div class="w-[90%]">
					<div class="product-title" style="margin-top: 15px">
						<span class="pro-details">
							<a class="category" href="/categories/{{ product.categories[0].id }}/{{ product.categories[0].slug }}">{{ product.categories[0].name }}</a>
							{% if product.is_infinite or product.quantity > 0 %}
								{% if product.has_options or product.has_fields %}
									<small style="font-size: 1.1rem">{{ locals.product_has_options }}</small>
								{% endif %}
								{% if not product.is_taxable %}
									<small style="font-size: 1.1rem">{{ locals.product_is_not_taxable }}</small>
								{% endif %}
							{% endif %}
						</span>
						<a href="/products/{{ product.slug }}" style="display: block; color: #000; font-size: 16px; font-weight: 400;">
							{{ product.name }}
						</a>
					</div>

					{% if store.is_product_reviews_enabled %}
						<div class="product-card-rating-wrapper" style="height: 18px">
							{% if product.rating %}
								{% include 'rating-stars.twig' with {'rating' : product.rating.average } %}
								<span class="product-card-rating-count">({{ product.rating.total_count }})</span>
							{% endif %}
						</div>
					{% endif %}

					<div class="product-crd-spec" >
						{% if product.formatted_sale_price %}
							<div style="display: flex;gap: 8px;" class="section-product-price">
								<div class="product-price theme-title-primary">
									<span>{{ product.formatted_sale_price }}</span>
								</div>
								<div style="color: #494949">
									<span class="product-prev-price">{{ product.formatted_price }}</span>
									<span style="color:#f25f5f;">
										&nbsp; &nbsp;{{ locals.product_discount }}&nbsp;{{ product.discount_percentage }}%
									</span>
								</div>
							</div>
						{% else %}
							<div  class="product-price section-product-price theme-title-primary">
								<span>{{ product.formatted_price }}</span>
							</div>
						{% endif %}

						{% if product.is_infinite == false and product.quantity <= 0 %}
							<small style="font-size: 1.1rem">{{ locals.lbl_error_product_out_of_stock }}</small>
						{% endif %}
					</div>
				</div>

				<!-- عرض التفاصيل في الهواتف المحمولة -->
				<div class="text-center mob">
					{% if product.is_infinite == false and product.quantity <= 0 %}
						<a class="btn btn-primary btn-product-card-out-of-stock" disabled>{{ locals.lbl_error_product_out_of_stock }}</a>
					{% elseif product.has_options or product.has_fields %}
						<a style="width: 100% !important;" class="btn btn-primary btn-product-card-select-variant" href="/products/{{ product.slug }}">{{ locals.add_to_cart }}</a>
					{% else %}
						<a href="javascript:void(0)" class="btn btn-primary product-card-add-to-cart" onclick="productCartAddToCart(this,'{{ product.id }}')">
							<img style="display: inline" class="add-to-cart-progress d-none" src="{{ asset_url }}spinner.gif" width="20px" height="20px"/>
							{{ locals.add_to_cart }}
						</a>
					{% endif %}
				</div>
			</div>
		</a>
	</div>
{% endif %}

<style>
	/* إعدادات المكونات */
	.product-item {
		padding: 15px;
		margin-bottom: 20px;
		border: 1px solid #eee;
		border-radius: 10px;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
	}

	.product-item img {
		width: 100%;
		height: auto;
		object-fit: cover;
	}

	.text-center button,
	.text-center a {
		width: 100%;
		margin-top: 10px;
		padding: 10px 15px;
		background-color: #d9534f;
		color: white;
		border-radius: 5px;
		font-size: 14px;
	}

	.text-center a[disabled] {
		background-color: #ccc;
	}

	.popup-product-details {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.8);
		justify-content: center;
		align-items: center;
		z-index: 1000;
	}

	.popup-content {
		display: flex;
		align-items: center;
		gap: 20px;
		background: white;
		padding: 20px;
		border-radius: 10px;
		position: relative;
	}

	.popup-image {
		max-width: 200px;
		margin-right: 20px;
	}

	.photo-product {
		min-width: 200px;
	}

	.popup-text {
		display: flex;
		flex-direction: column;
		gap: 10px;
		max-width: 300px;
	}

	.popup-text .name {
		font-size: 19px;
		font-weight: 700;
	}

	.price-product-discound {
		display: flex;
		align-items: center;
		gap: 10px;
	}

	#close-popup {
		position: absolute;
		top: 20px;
		right: 20px;
		cursor: pointer;
		font-size: 24px;
		color: white;
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', function () {
const popupContainer = document.querySelector('div.popup-product-details');

document.querySelectorAll('.open-product-details').forEach(button => {
button.addEventListener('click', function () {
const productId = this.getAttribute('data-product-id');
const productName = this.getAttribute('data-product-name');
const productDescription = this.getAttribute('data-description');
const productImage = this.getAttribute('data-product-image');
const productRealPrice = this.getAttribute('data-real-price');

// عرض المعلومات في البوب أب
document.querySelector('.popup-product-details img').setAttribute('src', productImage);
document.querySelector('.popup-product-details .name').textContent = productName;
document.querySelector('.popup-product-details .description').textContent = productDescription;
document.querySelector('.popup-product-details .price').textContent = productRealPrice;

// عرض البوب أب
popupContainer.style.display = 'flex';
});
});

document.getElementById('close-popup').addEventListener('click', function () {
popupContainer.style.display = 'none';
});
});
</script>
