{% extends "layout.twig" %}

{% block header %} {{ include('header.twig') }} {% endblock %}

{% block main_content %}
    {% if blog.handle is defined %}
        {% set blog_handle = blog.handle %}
    {% elseif blog.slug is defined %}
        {% set blog_handle = blog.slug %}
    {% else %}
        {% set blog_handle = '' %}
    {% endif %}
    {% if blog.alias is defined and blog_handle == '' %}
        {% set blog_handle = blog.alias %}
    {% endif %}
    <section class="blog mt-5 mb-5 ">
        <div class="container">

            <div class="blog-title mt-5 mb-5">
                <h1>
                    {{ blog.title }}
                </h1>
            </div>
            <div class="blog-text mt-3 mb-5">
                {% if blog_handle == 'options' or ('options' in blog_handle) %}
                    <div class="custom-options-content">
                     Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorum alias obcaecati commodi eligendi voluptates, illo inventore assumenda voluptate sapiente quisquam! Quam dolorem id fuga saepe, nostrum ad distinctio fugit. Hic.
                     Lorem ipsum dolor sit amet consectetur adipisicing elit. Debitis officia, accusantium rerum pariatur odio harum similique repellat. Placeat quas corrupti facere, iusto nobis totam dolorem distinctio accusamus harum optio officia.
                    </div>
                {% else %}
                    {{ blog.content | raw }}
                {% endif %}
            </div>


        </div>
    </section>

<
<script>
document.addEventListener('DOMContentLoaded', async function () {
  // ===== CONFIGURATION =====
  const TARGET_OPTION_NAME = 'Color';   // Option name (e.g. Color / اللون)
  const TARGET_OPTION_VALUE = 'Yellow'; // Option value (e.g. Yellow / اصفر)

  // =========================
  if (typeof zid === 'undefined' || !zid.store?.product?.fetchAll) {
    console.error('Zid Store API is not available');
    return;
  }

  // Fetch products from Zid (single page example)
  async function getProducts(page = 1) {
    const response = await zid.store.product.fetchAll(null, {
      page,
      per_page: 100
    });

    return response?.data?.products?.data || [];
  }

  const products = await getProducts(1);
  console.log('All products:', products);

  // =========================
  // FILTER PRODUCTS BY OPTION
  // =========================
  const filteredProducts = products.filter(product => {
    if (!product.variants || !product.options) return false;

    // Find the index of the target option (e.g. Color)
    const optionIndex = product.options.findIndex(option =>
      typeof option === 'object'
        ? option.name === TARGET_OPTION_NAME
        : option === TARGET_OPTION_NAME
    );

    if (optionIndex === -1) return false;

    // Check if ANY variant matches the option value
    return product.variants.some(variant => {
      if (!variant.attributes) return false;

      const attributes = Array.isArray(variant.attributes)
        ? variant.attributes
        : Object.values(variant.attributes);

      return attributes.some(attr =>
        attr &&
        Number(attr.option_index) === optionIndex &&
        String(attr.value).toLowerCase() === TARGET_OPTION_VALUE.toLowerCase()
      );
    });
  });

  // =========================
  // RESULT
  // =========================
  console.log(
    `Products with ${TARGET_OPTION_NAME} = ${TARGET_OPTION_VALUE}:`,
    filteredProducts
  );

  console.table(
    filteredProducts.map(p => ({
      id: p.id,
      name: p.name,
      slug: p.slug
    }))
  );
});
</script>



</script>



{% endblock %}





{% block footer %} {{ include('footer.twig') }} {% endblock %}
