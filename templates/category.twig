{% extends "layout.twig" %}

{% block header %} {{ include('header.twig') }} {% endblock %}

{% block main_content %}

    {% embed 'breadcrumb.twig' %}
        {% block breadcrumb_items %}
            <li class="breadcrumb-item" aria-current="page"><a href="/">{{ locals.home_title }}</a></li>

            {% if category.parent_category.parent_category %}
                <li class="breadcrumb-item" aria-current="page"><a href="{{ category.parent_category.parent_category.url }}">{{ category.parent_category.parent_category.name }}</a></li>
            {% endif %}

            {% if category.parent_category %}
                <li class="breadcrumb-item" aria-current="page"><a href="{{ category.parent_category.url }}">{{ category.parent_category.name }}</a></li>
            {% endif %}

            <li class="breadcrumb-item active " aria-current="page">{{ category.name }}</li>
        {% endblock %}
    {% endembed %}

    {% include 'breadcrumb-subTitle-detail.twig' with { 'title' : category.name, 'description': category.description } %}

    {% if category.sub_categories | length > 0 %}
    <div class="container pt-2 category-page-slider">
        <div class="home-categories-section section-padding-space">
            <div class="container slider-container">
                <h2 class="section-title" style="font-weight: normal; font-size: 1.167rem;">{{ locals.categories }}</h2>
                <div class="d-flex flex-column">
                    <div class="categories-slider-wrapper" style="position: relative">

                        <div class="categories-slider s-slider">
                            {% for categoryItem in category.sub_categories %}
                                <div class="cat-col">
                                    <div class="category-item">
                                        <a href="/categories/{{ categoryItem.id }}/{{ categoryItem.slug }}">

                                            <img
                                                    {% if categoryItem.image %}
                                                        src="{{ imageUrl(categoryItem.image, { w: 235, q: 100, f:'auto' }) }}"
                                                    {% else %}
                                                        src="{{ imageUrl(asset_url ~ 'product-img.svg',{ w: 235, q: 100, f:'auto' }) }}"
                                                    {% endif %}

                                                    loading="lazy" alt="{{ categoryItem.name }}">
                                            <h3>{{ categoryItem.name }}</h3>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <script>

            document.addEventListener("DOMContentLoaded", function(){
                var arrowNextClass = (window.appDirection === 'ltr') ? 'icon-keyboard_arrow_right': 'icon-keyboard_arrow_left';
                var arrowPrevClass = (window.appDirection === 'ltr') ? 'icon-keyboard_arrow_left' : 'icon-keyboard_arrow_right';
            });
        </script>
    </div>
    {% endif %}

    <div class="container d-flex flex-row">
        {% if  products.filters|length > 0 %}
            <div class="d-flex flex-column">
                {% include 'template_for_products_attributes' %}
                <div class="d-flex justify-content-end attributes-submit" style="padding-inline-end: 25px">
                    <button type="button" onclick="document.getElementById('attribute_form').submit()" class="highlight-button btn btn-sm" data-abc="true">تطبيق</button>
                </div>
            </div>
        {% endif %}
        <div class="products-container flex-grow-1 pt-4">
            <div class="side-banners">
				{% for banner in settings.categorySideBanners_sideBannerList %}
					<div class="banner-item">
						<a href="{{banner.sideBanerLinkUrl}}" class="containt">
							<h3>
								{{ banner.sideBanerTitle}}
							</h3>
							<p>{{banner.sideBanerLink}}</p>
						</a>
                        <img src="{{ banner.sideBanerImage }}" alt="{{ banner.title }}">
                    </div>	
				{% endfor %}
			</div>
            <div class="products-area">

                {% if  products.filters|length <= 0 %}
                    <div>
                        {% include 'products-filter.twig' with { 'count' : products.total, 'has_products_filtration': ( products.filters|length > 0) } %}
                    </div>
                 {% endif %}
                <div id="products-list" class="grid grid-cols-3 products-list">
                    {% for product in products.data %}
    
                        <div class="prod-col {% if products.filters|length > 0 %}prod-col-attr{% endif %} prod-col-tb">
                            {% include 'product-card.twig' with {'product' : product, 'index': key, 'pr_settings':settings} %}
                        </div>
    
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    {% include 'pagination.twig' with { 'totalPages' : products.last_page , 'currentPage' : products.current_page } %}

        <style>
			.products-container{
				display: flex;
			}
			.side-banners{
				flex-basis: 20%;
				display: flex;
				flex-direction: column;
				gap: 20px;
			}
			.side-banners .banner-item {
				position: relative;
				border-radius: 8px;
				overflow: hidden;
			}
			.side-banners .banner-item .containt{
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background-color: #0000003b;
				display: flex;
				justify-content: center;
				align-items: center;
				flex-direction: column;
				opacity: 0;
				transition: all ease-in-out 0.3s;
			}
			.side-banners .banner-item .containt:hover{
				opacity: 1;
			}

			.side-banners .banner-item .containt h3{
				color: var(--primary-color);
					text-align: center;
					font-size: 28px;
					font-weight: 600;
					line-height: 38.5px;
			}
			.side-banners .banner-item .containt p{
				color: var(--text-color-primary-bg);
				font-size: 28px;
				font-weight: 700;
			}
			
			.products-area{
				flex-basis: 78%;
			}
			@media (max-width: 992px){
				.side-banners{
					display: none;
				}
				.products-area{
				flex-basis: 100%;
			}
			}
		</style>

{% endblock %}

{% block footer %} {{ include('footer.twig') }} {% endblock %}


{% block footer_scripts %}
    <script>

    document.addEventListener('DOMContentLoaded', () => {
        const productShapes = document.querySelectorAll('.product_shap i');
        const productList = document.querySelector('#products-list');

        productShapes.forEach(productShape => {
            productShape.addEventListener('click', function (event) {
                const clickedIcon = event.target;
                const displayValue = clickedIcon.dataset.display;

                productList?.classList.remove('vertical', 'horizontal');
                productList?.classList.add(displayValue);

                productShapes.forEach(icon => icon.classList.remove('vr_hr_active'));
                event.target.classList.toggle('vr_hr_active');
            });
        });
    });



        window.onProductAttributesTriggered = function(){
            $('#products-list').css('opacity', '0.4');
        }

        window.onProductAttributesChanged = function(htmlStr){
            var html = $.parseHTML( htmlStr );
            $('#products-list').html($('#products-list', html).html());
            $('#products-list').css('opacity', '1');
        }
    </script>
{% endblock %}
